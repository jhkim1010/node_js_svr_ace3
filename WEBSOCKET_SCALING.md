# WebSocket í™•ì¥ì„± ê°€ì´ë“œ (1000ê°œ ì´ìƒ ì—°ê²°)

## í˜„ì¬ ìµœì í™” ìƒíƒœ

### âœ… ì´ë¯¸ êµ¬í˜„ëœ ìµœì í™”

1. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ ê³µìœ **
   - ë™ì¼í•œ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ëŠ” ì—°ê²° í’€ì„ ê³µìœ 
   - ìµœëŒ€ 200ê°œ ì—°ê²° í’€ (ë™ì‹œ ì²˜ë¦¬ í•­ëª© ìˆ˜ ì¦ê°€ ëŒ€ì‘)

2. **ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ìŠ¤ë„ˆ ê³µìœ **
   - ë™ì¼í•œ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•´ í•˜ë‚˜ì˜ LISTEN ë¦¬ìŠ¤ë„ˆë§Œ ìƒì„±
   - 1000ê°œ í´ë¼ì´ì–¸íŠ¸ê°€ ê°™ì€ DBì— ì—°ê²°ë˜ì–´ë„ ë¦¬ìŠ¤ë„ˆëŠ” 1ê°œë§Œ ì¡´ì¬

3. **í´ë¼ì´ì–¸íŠ¸ ê·¸ë£¹ ê´€ë¦¬**
   - ë°ì´í„°ë² ì´ìŠ¤ë³„ë¡œ í´ë¼ì´ì–¸íŠ¸ ê·¸ë£¹ ê´€ë¦¬
   - ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì‹œ í•´ë‹¹ DB ê·¸ë£¹ë§Œ ìˆœíšŒ

4. **ping/pong ìµœì í™”**
   - 60ì´ˆë§ˆë‹¤ ping ì „ì†¡ (ì—°ê²° ìœ ì§€ì— ì¶©ë¶„)
   - 1000ê°œ ì—°ê²° ì‹œ ì´ˆë‹¹ ì•½ 16-17ê°œ ping (ê´€ë¦¬ ê°€ëŠ¥í•œ ìˆ˜ì¤€)

5. **ë¹„ë™ê¸° ë©”ì‹œì§€ ì „ì†¡**
   - `setImmediate`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë²¤íŠ¸ ë£¨í”„ ë¸”ë¡œí‚¹ ë°©ì§€
   - ëŒ€ëŸ‰ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì‹œì—ë„ ë‹¤ë¥¸ ì‘ì—… ì²˜ë¦¬ ê°€ëŠ¥

### âš ï¸ ì¶”ê°€ ê³ ë ¤ì‚¬í•­

#### 1. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

**ê° ì—°ê²°ë‹¹ ë©”ëª¨ë¦¬:**
- WebSocket ê°ì²´: ~2-4KB
- í´ë¼ì´ì–¸íŠ¸ ì •ë³´: ~100 bytes
- ping ì¸í„°ë²Œ: ~100 bytes
- **ì´ê³„: ì•½ 3-5KB per connection**

**1000ê°œ ì—°ê²° ì‹œ:**
- ì•½ 3-5MB ë©”ëª¨ë¦¬ ì‚¬ìš©
- ì¼ë°˜ì ìœ¼ë¡œ ë¬¸ì œ ì—†ìŒ

**10000ê°œ ì—°ê²° ì‹œ:**
- ì•½ 30-50MB ë©”ëª¨ë¦¬ ì‚¬ìš©
- ì—¬ì „íˆ ê´€ë¦¬ ê°€ëŠ¥í•œ ìˆ˜ì¤€

#### 2. CPU ì‚¬ìš©ëŸ‰

**ping/pong:**
- 1000ê°œ ì—°ê²°: ì´ˆë‹¹ ì•½ 16-17ê°œ ping
- CPU ë¶€í•˜: ë§¤ìš° ë‚®ìŒ

**ë¸Œë¡œë“œìºìŠ¤íŠ¸:**
- 1000ê°œ í´ë¼ì´ì–¸íŠ¸ì— ë©”ì‹œì§€ ì „ì†¡ ì‹œ ìˆœíšŒ í•„ìš”
- ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì´ë²¤íŠ¸ ë£¨í”„ ë¸”ë¡œí‚¹ ë°©ì§€
- ì„±ëŠ¥: ì–‘í˜¸

#### 3. ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­

**ping/pong:**
- ê° ping: ì•½ 2 bytes
- 1000ê°œ ì—°ê²°: ì´ˆë‹¹ ì•½ 32-34 bytes (ë¬´ì‹œ ê°€ëŠ¥í•œ ìˆ˜ì¤€)

**ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸:**
- ë©”ì‹œì§€ í¬ê¸°ì— ë”°ë¼ ë‹¤ë¦„
- ì¼ë°˜ì ìœ¼ë¡œ ì‘ì€ ë©”ì‹œì§€ (JSON): 100-500 bytes
- 1000ê°œ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡: ì•½ 100-500 KB per broadcast

#### 4. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€

**í˜„ì¬ ì„¤ì •:**
```javascript
pool: {
    max: 200,        // ìµœëŒ€ ì—°ê²° ìˆ˜
    min: 0,          // ìµœì†Œ ì—°ê²° ìˆ˜
    idle: 10000,     // ìœ íœ´ ì—°ê²° ìœ ì§€ ì‹œê°„
    acquire: 60000,  // ì—°ê²° íšë“ ëŒ€ê¸° ì‹œê°„
}
```

**1000ê°œ WebSocket ì—°ê²° ì‹œ:**
- ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì€ í’€ì—ì„œ ê³µìœ ë¨
- ìµœëŒ€ 200ê°œ ì—°ê²°ë¡œ ì¶©ë¶„ (ëŒ€ë¶€ë¶„ì˜ ê²½ìš°)
- í•„ìš”ì‹œ `max` ê°’ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìŒ

#### 5. Nginx ì„¤ì • ìµœì í™”

**í˜„ì¬ ì„¤ì • í™•ì¸:**
```nginx
location /api {
    proxy_pass http://localhost:3030;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
    
    # WebSocket íƒ€ì„ì•„ì›ƒ ì„¤ì •
    proxy_read_timeout 86400s;  # 24ì‹œê°„
    proxy_send_timeout 86400s;  # 24ì‹œê°„
    proxy_buffering off;
}
```

**1000ê°œ ì´ìƒ ì—°ê²° ì‹œ ì¶”ê°€ ì„¤ì • ê¶Œì¥:**
```nginx
# http ë¸”ë¡ì— ì¶”ê°€
worker_processes auto;  # CPU ì½”ì–´ ìˆ˜ì— ë§ê²Œ ìë™ ì„¤ì •
worker_connections 2048;  # ê° workerì˜ ìµœëŒ€ ì—°ê²° ìˆ˜

# events ë¸”ë¡ì— ì¶”ê°€
use epoll;  # Linuxì—ì„œ íš¨ìœ¨ì ì¸ ì´ë²¤íŠ¸ ëª¨ë¸

# server ë¸”ë¡ì— ì¶”ê°€
location /api {
    # ê¸°ì¡´ ì„¤ì •...
    
    # ì¶”ê°€ ìµœì í™”
    proxy_buffering off;
    proxy_request_buffering off;
    
    # ì—°ê²° ìœ ì§€ ì„¤ì •
    keepalive_timeout 86400s;
    keepalive_requests 10000;
}
```

#### 6. Node.js ì„¤ì • ìµœì í™”

**í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:**
```bash
# ì´ë²¤íŠ¸ ë£¨í”„ ìµœì í™”
UV_THREADPOOL_SIZE=16  # ê¸°ë³¸ê°’: 4, CPU ì½”ì–´ ìˆ˜ì— ë§ê²Œ ì¡°ì •

# ë©”ëª¨ë¦¬ ì œí•œ (í•„ìš”ì‹œ)
NODE_OPTIONS="--max-old-space-size=4096"  # 4GB
```

**í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬:**
- PM2 ë˜ëŠ” cluster ëª¨ë“ˆ ì‚¬ìš© ê¶Œì¥
- ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ë¡œ ë¶€í•˜ ë¶„ì‚° ê°€ëŠ¥

#### 7. ëª¨ë‹ˆí„°ë§

**ì—°ê²° ìˆ˜ í™•ì¸:**
```javascript
// ì„œë²„ì— ì¶”ê°€ ê°€ëŠ¥í•œ ì—”ë“œí¬ì¸íŠ¸
app.get('/api/websocket/stats', (req, res) => {
    const stats = {
        totalConnections: wss ? wss.clients.size : 0,
        dbGroups: dbClientGroups.size,
        dbListeners: dbListeners.size,
        memoryUsage: process.memoryUsage()
    };
    res.json(stats);
});
```

**ë¡œê·¸ ìµœì í™”:**
- ëŒ€ëŸ‰ ì—°ê²° ì‹œ ìƒì„¸ ë¡œê·¸ëŠ” ì„±ëŠ¥ì— ì˜í–¥
- ì¤‘ìš”í•œ ì´ë²¤íŠ¸ë§Œ ë¡œê¹… (ì—°ê²°/í•´ì œ, ì—ëŸ¬ ë“±)
- ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë¡œê·¸ëŠ” ëŒ€ëŸ‰ì¸ ê²½ìš°ì—ë§Œ ì¶œë ¥

## ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì˜ˆìƒì¹˜

### 1000ê°œ ì—°ê²°
- **ë©”ëª¨ë¦¬**: 3-5MB
- **CPU**: ë§¤ìš° ë‚®ìŒ (< 5%)
- **ë„¤íŠ¸ì›Œí¬**: ping/pong ë¬´ì‹œ ê°€ëŠ¥
- **ë¸Œë¡œë“œìºìŠ¤íŠ¸**: 1000ê°œ í´ë¼ì´ì–¸íŠ¸ì— ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì•½ 10-50ms

### 5000ê°œ ì—°ê²°
- **ë©”ëª¨ë¦¬**: 15-25MB
- **CPU**: ë‚®ìŒ (< 10%)
- **ë„¤íŠ¸ì›Œí¬**: ping/pong ë¬´ì‹œ ê°€ëŠ¥
- **ë¸Œë¡œë“œìºìŠ¤íŠ¸**: 5000ê°œ í´ë¼ì´ì–¸íŠ¸ì— ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì•½ 50-200ms

### 10000ê°œ ì—°ê²°
- **ë©”ëª¨ë¦¬**: 30-50MB
- **CPU**: ì¤‘ê°„ (< 20%)
- **ë„¤íŠ¸ì›Œí¬**: ping/pong ë¬´ì‹œ ê°€ëŠ¥
- **ë¸Œë¡œë“œìºìŠ¤íŠ¸**: 10000ê°œ í´ë¼ì´ì–¸íŠ¸ì— ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì•½ 100-500ms

## ê¶Œì¥ ì‚¬í•­

### âœ… í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ì¶©ë¶„í•œ ê²½ìš°
- 1000ê°œ ì´í•˜ ì—°ê²°
- í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ë¬¸ì œ ì—†ìŒ

### âš ï¸ ì¶”ê°€ ìµœì í™”ê°€ í•„ìš”í•œ ê²½ìš°
- 5000ê°œ ì´ìƒ ì—°ê²°
- Nginx worker ì„¤ì • ì¡°ì •
- Node.js í´ëŸ¬ìŠ¤í„° ëª¨ë“œ ê³ ë ¤
- ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ìµœì í™” (ë°°ì¹˜ ì²˜ë¦¬)

### ğŸ”§ í™•ì¥ì„± í–¥ìƒ ë°©ë²•

1. **í´ëŸ¬ìŠ¤í„° ëª¨ë“œ ì‚¬ìš©**
   ```javascript
   const cluster = require('cluster');
   const numCPUs = require('os').cpus().length;
   
   if (cluster.isMaster) {
       for (let i = 0; i < numCPUs; i++) {
           cluster.fork();
       }
   } else {
       // ì„œë²„ ì‹œì‘
   }
   ```

2. **Redisë¥¼ í†µí•œ ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸**
   - ì—¬ëŸ¬ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ê°„ ë©”ì‹œì§€ ê³µìœ 
   - ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥

3. **ë©”ì‹œì§€ í ì‚¬ìš©**
   - RabbitMQ, Kafka ë“± ì‚¬ìš©
   - ëŒ€ëŸ‰ ë©”ì‹œì§€ ì²˜ë¦¬ ìµœì í™”

## ê²°ë¡ 

**í˜„ì¬ ì„¤ì •ìœ¼ë¡œ 1000ê°œ ì´ìƒì˜ ì—°ê²°ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

ì£¼ìš” ì´ìœ :
1. âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ ê³µìœ 
2. âœ… ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ìŠ¤ë„ˆ ê³µìœ 
3. âœ… ë¹„ë™ê¸° ë©”ì‹œì§€ ì „ì†¡
4. âœ… íš¨ìœ¨ì ì¸ í´ë¼ì´ì–¸íŠ¸ ê·¸ë£¹ ê´€ë¦¬
5. âœ… ìµœì í™”ëœ ping/pong ë©”ì»¤ë‹ˆì¦˜

ì¶”ê°€ ìµœì í™”ëŠ” ì‹¤ì œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ í›„ í•„ìš”ì— ë”°ë¼ ì§„í–‰í•˜ì„¸ìš”.

